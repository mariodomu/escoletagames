<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Feed the Monster</title>
  <style>
    :root {
      --bg1: #ffecd2;
      --bg2: #fcb69f;
      --bg3: #ffd7ba;
      --monster: #7bdff2;
      --monster-dark: #4cc9f0;
      --mouth: #1b1b1b;
      --eye: #222;
      --btn: #fff7;
      --meter-bg: #ffffffaa;
      --meter-fill: #7CFF7A;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: "Comic Sans MS", "Trebuchet MS", system-ui; }
    body {
      background:
        radial-gradient(circle at 15% 20%, #fff8 0 1.2vmin, transparent 1.25vmin),
        radial-gradient(circle at 75% 30%, #fff7 0 1.1vmin, transparent 1.15vmin),
        radial-gradient(circle at 35% 60%, #fff5 0 0.9vmin, transparent 1vmin),
        linear-gradient(180deg, var(--bg1), var(--bg2), var(--bg3));
      overflow: hidden;
      user-select: none;
      touch-action: manipulation;
    }

    .game {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-rows: 1fr auto;
      align-items: center;
      justify-items: center;
      padding: 2vmin;
      gap: 2vmin;
    }
    .game.prestart .hud,
    .game.prestart .request,
    .game.prestart .foods {
      opacity: 0;
      pointer-events: none;
    }
    .game.prestart .monster-wrap {
      transform: scale(0.9);
    }

    .start-screen {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
      z-index: 20;
    }
    .start-card {
      pointer-events: auto;
      display: grid;
      gap: 1.5vmin;
      justify-items: center;
      margin-top: 42vmin;
      background: #ffffffcc;
      border-radius: 3vmin;
      padding: 2vmin;
      box-shadow: 0 1vmin 2vmin #0002;
    }
    .start-title {
      font-size: 4vmin;
      line-height: 1;
    }
    .start-btn {
      font-size: 5vmin;
      padding: 1.2vmin 4vmin;
      border: 0.4vmin solid #fff;
      border-radius: 2.5vmin;
      background: linear-gradient(180deg, #ffe66d, #ffc857);
      box-shadow: 0 0.8vmin 1.4vmin #0002;
      cursor: pointer;
    }
    .start-btn:active { transform: scale(0.98); }
    .game.started .start-screen {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    /* Monster */
    .monster-wrap {
      position: relative;
      width: min(70vmin, 70vh);
      height: min(70vmin, 70vh);
      display: flex;
      align-items: center;
      justify-content: center;
      transform: scale(var(--monster-scale, 0.78));
      transition: transform 0.2s ease;
    }
    .monster-wrap.wiggle {
      animation: wiggle 0.35s ease-in-out 1;
    }
    @keyframes wiggle {
      0% { transform: scale(var(--monster-scale, 0.78)) rotate(0deg); }
      25% { transform: scale(var(--monster-scale, 0.78)) rotate(-3deg); }
      50% { transform: scale(var(--monster-scale, 0.78)) rotate(3deg); }
      75% { transform: scale(var(--monster-scale, 0.78)) rotate(-2deg); }
      100% { transform: scale(var(--monster-scale, 0.78)) rotate(0deg); }
    }
    .monster {
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 20%, #fff7, transparent 45%),
                  radial-gradient(circle at 70% 80%, #0002, transparent 55%),
                  var(--monster);
      border-radius: 45% 45% 40% 40% / 50% 50% 45% 45%;
      box-shadow: 0 1vmin 3vmin #0002;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4vmin;
      position: relative;
      transition: background 0.2s ease, transform 0.15s ease;
    }
    .monster.happy { transform: scale(1.02); }
    .monster.angry { transform: scale(0.99); filter: saturate(1.05); }

    .eyes {
      display: flex;
      gap: 8vmin;
    }
    .eye {
      width: 7vmin;
      height: 9vmin;
      background: #fff;
      border-radius: 50%;
      position: relative;
      box-shadow: inset 0 -0.8vmin 0 #0001;
    }
    .eye::after {
      content: "";
      position: absolute;
      width: 3vmin;
      height: 3vmin;
      background: var(--eye);
      border-radius: 50%;
      top: 3vmin;
      left: 2vmin;
      transition: transform 0.1s ease;
    }
    .monster.blink .eye::after {
      transform: scaleY(0.2);
    }

    .mouth {
      width: 20vmin;
      height: 12vmin;
      background: var(--mouth);
      border-radius: 0 0 10vmin 10vmin / 0 0 12vmin 12vmin;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 1vmin 0 #0005;
    }
    .mouth::after {
      content: "";
      position: absolute;
      width: 18vmin;
      height: 8vmin;
      background: #ff6b6b;
      border-radius: 0 0 8vmin 8vmin;
      bottom: -2vmin;
      left: 1vmin;
    }
    .monster.happy .mouth { height: 14vmin; }
    .monster.happy .eye::after { transform: translateY(0.5vmin) scale(0.9); }
    .monster.angry .mouth {
      height: 9vmin;
      border-radius: 10vmin 10vmin 0 0 / 8vmin 8vmin 0 0;
    }
    .monster.angry .mouth::after { bottom: -6vmin; }
    .monster.angry .eye::after { transform: translateY(-0.25vmin) scale(1.02); }

    /* Yum meter */
    .meter {
      position: absolute;
      top: 2vmin;
      left: 2vmin;
      width: 30vmin;
      height: 4vmin;
      background: var(--meter-bg);
      border-radius: 2vmin;
      overflow: hidden;
      border: 0.5vmin solid #fff;
      box-shadow: 0 0.6vmin 1.2vmin #0002;
    }
    .meter::before {
      content: attr(data-icon);
      position: absolute;
      left: 1vmin;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.2vmin;
      z-index: 1;
      opacity: 0.9;
    }
    .meter-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--meter-fill), #ffe66d);
      transition: width 0.2s ease;
      transform-origin: left;
    }
    .meter.water {
      top: 7vmin;
      height: 3.5vmin;
    }
    .meter-fill.water {
      background: linear-gradient(90deg, #7bdff2, #4cc9f0);
    }

    /* Controls */
    .controls {
      position: absolute;
      top: 2vmin;
      right: 2vmin;
      display: flex;
      gap: 2vmin;
    }
    .hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .hud > * { pointer-events: auto; }
    .btn {
      font-size: 3vmin;
      padding: 1.2vmin 2.5vmin;
      border: none;
      border-radius: 2vmin;
      background: #ffffffcc;
      box-shadow: 0 0.8vmin 1.2vmin #0002;
      cursor: pointer;
    }
    .btn:active { transform: scale(0.98); }

    .silly { background: #ffe66dcc; }
    .silly.on { background: #a0ffe6; }

    /* Food area */
    .foods {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(18vmin, 1fr));
      gap: 2vmin;
      padding: 0 6vmin 4vmin;
    }
    .food {
      font-size: 10vmin;
      background: var(--btn);
      border-radius: 3vmin;
      display: grid;
      place-items: center;
      padding: 2vmin 0;
      box-shadow: 0 1vmin 2vmin #0002;
      cursor: pointer;
      transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
      border: 0.45vmin solid #0003;
    }
    .food:active { transform: scale(0.96); }
    .food.wanted {
      border-color: #fff;
      box-shadow: 0 0 0 0.7vmin #fff8, 0 1vmin 2vmin #0002;
      animation: wantedPulse 1.2s ease-in-out infinite;
    }
    @keyframes wantedPulse {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-0.6vmin) scale(1.02); }
    }

    /* Request bubble (monster asking) */
    .request {
      position: absolute;
      top: 6vmin;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 1.2vmin 2.4vmin;
      border-radius: 3vmin;
      font-size: 6vmin;
      box-shadow: 0 0.8vmin 1.2vmin #0002;
      z-index: 4;
      animation: request-pop 0.18s ease-out;
    }
    .request::after {
      content: "";
      position: absolute;
      left: 50%;
      bottom: -1.6vmin;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 1.6vmin solid transparent;
      border-right: 1.6vmin solid transparent;
      border-top: 1.6vmin solid #fff;
    }
    @keyframes request-pop {
      0% { transform: translateX(-50%) scale(0.92); }
      100% { transform: translateX(-50%) scale(1); }
    }

    .streak {
      position: absolute;
      top: 11.5vmin;
      left: 2vmin;
      background: #ffffffcc;
      border-radius: 2vmin;
      padding: 0.5vmin 1.3vmin;
      font-size: 3vmin;
      min-width: 8vmin;
      text-align: center;
      box-shadow: 0 0.6vmin 1.2vmin #0002;
    }

    /* Flying food */
    .fly {
      position: absolute;
      font-size: 8vmin;
      pointer-events: none;
      z-index: 5;
      transition: transform 0.55s ease-in-out, opacity 0.55s ease-in-out;
    }

    /* Sparkles */
    .sparkle {
      position: absolute;
      width: 2vmin;
      height: 2vmin;
      background: #fff;
      border-radius: 50%;
      opacity: 0;
      animation: pop 0.6s ease-out forwards;
    }
    @keyframes pop {
      0% { transform: scale(0.5) translate(0, 0); opacity: 0; }
      30% { opacity: 1; }
      100% { transform: scale(1) translate(var(--dx), var(--dy)); opacity: 0; }
    }

    /* Speech bubble */
    .bubble {
      position: absolute;
      top: 6vmin;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 1vmin 2vmin;
      border-radius: 2vmin;
      font-size: 4vmin;
      box-shadow: 0 0.8vmin 1.2vmin #0002;
      opacity: 0;
      animation: bubble 1s ease-in-out forwards;
    }
    @keyframes bubble {
      0% { opacity: 0; transform: translate(-50%, 1vmin); }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -1vmin); }
    }

    /* Poop drop */
    .poop {
      position: absolute;
      font-size: 12vmin;
      left: 50%;
      top: 65%;
      transform: translateX(-50%);
      animation: poop 2.4s ease-in forwards;
      pointer-events: none;
      z-index: 10;
    }
    @keyframes poop {
      0% { transform: translate(-50%, 0) scale(0.8); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translate(-50%, 50vmin) scale(1); opacity: 0; }
    }

    /* Pee drop */
    .pee {
      position: absolute;
      font-size: 9vmin;
      left: 50%;
      top: 66%;
      transform: translateX(-50%);
      animation: pee 2s ease-in forwards;
      pointer-events: none;
      z-index: 10;
    }
    @keyframes pee {
      0% { transform: translate(-50%, 0) scale(0.8); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translate(-50%, 45vmin) scale(1); opacity: 0; }
    }

    .burst {
      position: absolute;
      left: 50%;
      top: 42%;
      transform: translate(-50%, -50%);
      font-size: 10vmin;
      opacity: 0;
      animation: burst 0.65s ease-out forwards;
      pointer-events: none;
      z-index: 9;
    }
    @keyframes burst {
      0% { transform: translate(-50%, -50%) scale(0.4); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translate(-50%, -60%) scale(1.15); opacity: 0; }
    }

    @media (max-width: 800px) {
      .foods { grid-template-columns: repeat(3, minmax(0, 1fr)); padding: 0 2vmin 3vmin; }
      .food { font-size: 12vmin; }
      .request { top: 9vmin; }
      .meter { width: 40vmin; }
      .streak { top: 14vmin; }
      .start-card { margin-top: 52vmin; }
      .start-btn { font-size: 7vmin; }
    }
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
    }
  </style>
</head>
<body>
  <div class="game prestart" id="game">
    <div class="hud" aria-hidden="false">
      <div class="meter" data-icon="ðŸ½ï¸" aria-hidden="true"><div class="meter-fill" id="meter"></div></div>
      <div class="meter water" data-icon="ðŸ’§" aria-hidden="true"><div class="meter-fill water" id="waterMeter"></div></div>
      <div class="streak" id="streak" aria-live="polite">0</div>
      <div class="controls">
        <button class="btn" id="reset">Reset</button>
        <button class="btn silly" id="silly">Silly Mode</button>
      </div>
    </div>
    <div class="request" id="request" aria-live="polite"></div>

    <div class="monster-wrap">
      <div class="monster" id="monster" role="img" aria-label="Cute monster">
        <div class="eyes">
          <div class="eye"></div>
          <div class="eye"></div>
        </div>
        <div class="mouth" id="mouth"></div>
      </div>
    </div>

    <div class="foods" id="foods">
      <!-- Foods injected by JS -->
    </div>

    <div class="start-screen" id="startScreen">
      <div class="start-card">
        <div class="start-title">Feed the Monster</div>
        <button class="start-btn" id="startBtn" type="button">Start</button>
      </div>
    </div>
  </div>

  <script>
    // Simple, safe, kid-friendly game logic
    const WATER = "ðŸ’§";
    const foods = ["ðŸŽ", "ðŸŒ", "ðŸª", "ðŸ¥•", "ðŸ“", WATER];
    const foodsEl = document.getElementById("foods");
    const gameEl = document.getElementById("game");
    const monster = document.getElementById("monster");
    const monsterWrap = document.querySelector(".monster-wrap");
    const mouth = document.getElementById("mouth");
    const meter = document.getElementById("meter");
    const waterMeter = document.getElementById("waterMeter");
    const streakEl = document.getElementById("streak");
    const requestEl = document.getElementById("request");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("reset");
    const sillyBtn = document.getElementById("silly");
    let yummy = 0; // 0..100
    let water = 0; // 0..100
    let silly = false;
    let wanted = foods[Math.floor(Math.random() * foods.length)];
    let size = 0.78;
    let full = false;
    let waterFull = false;
    let streak = 0;
    let started = false;
    let audioCtx;

    // Build food buttons
    function renderFoods(list) {
      if (!started) {
        foodsEl.innerHTML = "";
        return;
      }
      foodsEl.innerHTML = "";
      list.forEach((emoji) => {
        const btn = document.createElement("button");
        btn.className = "food";
        btn.type = "button";
        btn.textContent = emoji;
        btn.setAttribute("aria-label", "Feed " + emoji);
        btn.addEventListener("click", () => feed(emoji, btn));
        foodsEl.appendChild(btn);
      });
    }

    // Shuffle array (Fisher-Yates)
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Short generated sounds (no external files)
    function playTone(startHz, endHz, dur = 0.12, type = "square", vol = 0.3) {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(startHz, t);
      osc.frequency.exponentialRampToValueAtTime(endHz, t + dur * 0.7);
      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(vol, t + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + dur);
      osc.connect(gain).connect(audioCtx.destination);
      osc.start(t);
      osc.stop(t + dur + 0.01);
    }

    function chomp() {
      playTone(220, 110, 0.12, "square", 0.28);
    }

    function ding() {
      playTone(520, 760, 0.09, "triangle", 0.18);
    }

    function buzz() {
      playTone(180, 120, 0.1, "sawtooth", 0.1);
    }

    // Create sparkle/confetti around monster
    function sparkles() {
      for (let i = 0; i < 10; i++) {
        const s = document.createElement("div");
        s.className = "sparkle";
        const angle = Math.random() * Math.PI * 2;
        const dist = 8 + Math.random() * 10;
        s.style.left = "50%";
        s.style.top = "45%";
        s.style.background = `hsl(${Math.random() * 360}, 90%, 70%)`;
        s.style.setProperty("--dx", `${Math.cos(angle) * dist}vmin`);
        s.style.setProperty("--dy", `${Math.sin(angle) * dist}vmin`);
        monster.appendChild(s);
        s.addEventListener("animationend", () => s.remove());
      }
    }

    // Optional speech bubble
    function maybeBubble() {
      if (Math.random() > 0.2) return;
      const words = ["Yum!", "More!", "Yay!", "Nope!"];
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = words[Math.floor(Math.random() * words.length)];
      monster.parentElement.appendChild(bubble);
      bubble.addEventListener("animationend", () => bubble.remove());
    }

    // Feed action with safe repeat handling
    function feed(emoji, sourceEl) {
      if (!started) return;
      // Create flying emoji
      const fly = document.createElement("div");
      fly.className = "fly";
      fly.textContent = emoji;
      document.body.appendChild(fly);

      const src = sourceEl.getBoundingClientRect();
      const dst = mouth.getBoundingClientRect();
      const startX = src.left + src.width / 2;
      const startY = src.top + src.height / 2;
      const endX = dst.left + dst.width / 2;
      const endY = dst.top + dst.height / 2;

      fly.style.transform = `translate(${startX}px, ${startY}px)`;
      requestAnimationFrame(() => {
        fly.style.opacity = "1";
        fly.style.transform = `translate(${endX}px, ${endY}px) scale(0.3)`;
      });

      // Clean up after animation
      setTimeout(() => fly.remove(), 400);

      // Chomp + reaction based on match
      const matched = emoji === wanted;
      chomp();
      monster.classList.remove("happy", "angry");
      monster.classList.add(matched ? "happy" : "angry");
      if (matched) {
        streak += 1;
        ding();
        sparkles();
      } else {
        streak = 0;
        buzz();
        monsterWrap.classList.remove("wiggle");
        void monsterWrap.offsetWidth;
        monsterWrap.classList.add("wiggle");
      }
      maybeBubble();
      if (silly) randomMonsterColor();
      updateStreak();

      // Meter update (cap at 100)
      yummy = Math.min(100, yummy + (matched ? 12 : 6));
      meter.style.width = yummy + "%";

      // Water meter when water is given (even if the request was different)
      if (emoji === WATER && waterMeter) {
        water = Math.min(100, water + (matched ? 25 : 12));
        waterMeter.style.width = water + "%";
        if (!waterFull && water >= 100) {
          waterFull = true;
          showBurst("ðŸ’¦");
          pee();
          setTimeout(() => {
            water = 0;
            waterMeter.style.width = "0%";
            waterFull = false;
          }, 2000);
        }
      }

      // If full, poop and reset the meter after the gag
      if (!full && yummy >= 100) {
        full = true;
        showBurst("ðŸ’©");
        poop();
        setTimeout(() => {
          yummy = 0;
          meter.style.width = "0%";
          full = false;
        }, 2400);
      }

      // Grow only on correct food
      if (matched) {
        size = Math.min(1.2, size + (streak >= 4 ? 0.05 : 0.03));
        monsterWrap.style.setProperty("--monster-scale", size.toFixed(2));
      }

      // New request
      wanted = foods[Math.floor(Math.random() * foods.length)];
      updateRequest();

      // Shuffle foods after feeding
      renderFoods(shuffle(foods));
    }

    function updateRequest() {
      requestEl.textContent = started ? wanted : "";
    }

    function startGame() {
      started = true;
      gameEl.classList.remove("prestart");
      gameEl.classList.add("started");
      updateRequest();
      renderFoods(shuffle(foods));
    }

    function updateStreak() {
      streakEl.textContent = streak > 0 ? "ðŸ”¥" + streak : "0";
    }

    function poop() {
      const p = document.createElement("div");
      p.className = "poop";
      p.textContent = "ðŸ’©";
      monsterWrap.appendChild(p);
      p.addEventListener("animationend", () => p.remove());
    }

    function pee() {
      const p = document.createElement("div");
      p.className = "pee";
      p.textContent = "ðŸ’¦";
      monsterWrap.appendChild(p);
      p.addEventListener("animationend", () => p.remove());
    }

    function showBurst(icon) {
      const b = document.createElement("div");
      b.className = "burst";
      b.textContent = icon;
      monsterWrap.appendChild(b);
      b.addEventListener("animationend", () => b.remove());
    }

    function randomMonsterColor() {
      const hue = Math.floor(Math.random() * 360);
      monster.style.background = `radial-gradient(circle at 30% 20%, #fff7, transparent 45%),\
        radial-gradient(circle at 70% 80%, #0002, transparent 55%),\
        hsl(${hue}, 80%, 70%)`;
    }

    // Reset
    resetBtn.addEventListener("click", () => {
      yummy = 0;
      water = 0;
      meter.style.width = "0%";
      waterMeter.style.width = "0%";
      streak = 0;
      updateStreak();
      monster.classList.remove("happy");
      monster.classList.remove("angry");
      monsterWrap.classList.remove("wiggle");
      monster.style.background = "";
      size = 0.78;
      full = false;
      waterFull = false;
      monsterWrap.style.setProperty("--monster-scale", size.toFixed(2));
      wanted = foods[Math.floor(Math.random() * foods.length)];
      updateRequest();
      renderFoods(foods);
    });

    startBtn.addEventListener("click", () => {
      if (started) return;
      startGame();
    });

    // Silly mode toggle
    sillyBtn.addEventListener("click", () => {
      silly = !silly;
      sillyBtn.classList.toggle("on", silly);
      sillyBtn.textContent = silly ? "Silly: ON" : "Silly Mode";
    });

    // Start
    updateRequest();
    renderFoods(foods);
    updateStreak();
    monsterWrap.style.setProperty("--monster-scale", size.toFixed(2));
    setInterval(() => {
      monster.classList.add("blink");
      setTimeout(() => monster.classList.remove("blink"), 120);
    }, 2800);
  </script>
</body>
</html>
